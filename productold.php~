<?php 

session_start();  //look into cookies later

//gets the Solarium library (it's a solr php wrapper)
require('./scripts/php/Solarium/library/Solarium/Autoloader.php');
Solarium_Autoloader::register();

//the intial config that looks at local host at port 8983
$config = array(
    'adapteroptions' => array(
        'host' => '127.0.0.1',
        'port' => 8983,
        'path' => '/solr/',
    )
);

// creates a client instance for an actual search
$client = new Solarium_Client($config);

// get a select query instance
$query = $client->createSelect();

$query->setStart(0)->setRows(1);

//Gets the search terms and categories from the URL
$id=$_GET['id']; 


$query->setQuery("id:$id");  

// set fields to fetch certain things from my schema
$query->setFields(array('productssid','sellprice','picy','id'));

  //sets the query
  $totalresultset = $client->select($query);

  // show documents using the resultset iterator
  foreach ($totalresultset as $document) {
       $items=array();

      // the documents are also iterable, to get all fields
      foreach($document AS $field => $value)
      {
           if ($field=='productssid'){
                  $items[0]=$value;
	  }
          if ($field=='sellprice'){
                  $items[1]=$value;
	   }
          if ($field=='picy'){
                  $items[2]=$value;
	   }
          if ($field=='id'){
                  $items[3]=$value;
	   }
      }
      $picture='<a href="./product.php?&id='.$items[3].'"><img src="'.$items[2].'" width="250" height="250" alt="image 01" border="0" /></a>';
      $productinfo=' <p><h3> '.$items[0].'</h3></p> <p><h4> Price:$ '.$items[1].'</h4></p>';	



       $arr = unserialize($_COOKIE['RecentlyViewed']);
       //new add
       $arr[] = '<a href="./product.php?&id='.$items[3].'"><img src="'.$items[2].'" width="150" height="150" alt="image 01" border="0" /></a> <br /><name> '.$items[0].'</name> <br /> '.$items[1].'';

      if(sizeof($arr)>10){
                array_splice($arr, 0, 1);
      }

       setcookie("RecentlyViewed",'',time()-10); 
       setcookie('RecentlyViewed', serialize($arr), time()+10000);

  }






$queryMORE = $client->createMoreLikeThis();



$queryMORE->setQuery("id:$id");
$queryMORE->setMltFields('productssid,cat4');
$queryMORE->setMinimumDocumentFrequency(1);
$queryMORE->setMinimumTermFrequency(1);
//$queryMORE->createFilterQuery('stock')->setQuery('inStock:true');
//$queryMORE->setInterestingTerms('details');
$queryMORE->setMatchInclude(true);

// this executes the query and returns the result
$resultsetMore = $client->select($queryMORE);


// show MLT documents using the resultset iterator
foreach ($resultsetMore as $document) {
 //   echo '<hr/><table>';

    // the documents are also iterable, to get all fields
    foreach($document AS $field => $value)
    {
        // this converts multivalue fields to a comma-separated string
        if(is_array($value)) $value = implode(', ', $value);
        	if ($field=='id'){
		     $id=$value;
		}
		if ($field=='productssid'){
		     $name=$value;
		}
		if ($field=='sellprice'){
		     $price=$value;
		}
		if ($field=='picy'){ 
		     $URL=$value;
		}
	      	
    }
	$MoreLikeThisOutput.= '<li><a href="./product.php?&id='.$id.'"><img src="'.$URL.'" width="150" height="150" alt="image 01" border="0" /></a> <br /><name> '.$name.'</name> <br /> '.$price.'<br> </li>';
 //   echo '</table>';
}

	


?>




 

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ucalypt</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="style/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
    </style>
    <link href="style/css/bootstrap-responsive.css" rel="stylesheet">

        <script type="text/javascript">

		$(document).ready(function() {
			$('#liquidproduct').liquidcarousel({height:300, duration:1000, hidearrows:false});
		});
		
		
	</script>


  </head>









<body>

<?php include_once("template_header.php");?>





    <h2>Current Item  </h2>
     <hr width="85%">
    <div id="productlisting">
    
     <?php echo $searchOutput; ?>



      </div>





  <!--------------------------------------
Start of the of the first image carosoual
----------------------------------------->

<br>
<br>
<h2>Similiar Items  </h2>
<hr width="85%">
<div id="liquidproduct" class="liquid">

	<span class="previous"> <img src="style/images/previous.png" /> </span>
    
	<div class="wrapper">

		<ul>
			<?php echo $MoreLikeThisOutput; ?> 
		</ul>
	</div>
	<span class="next"><img src="style/images/next.png" />
     </span>
</div>

<!--------------------------------------
Start of the first  image carosoual
-----------------------------------------> 








    <div class="container-fluid">
          <hr>
          <div class="row-fluid">
              <div class="span6">
		 <?php echo $picture; ?> 
              </div><!--/span-->
              <div class="span6">
                   <?php echo $productinfo; ?> 
                  <div class="row-fluid">

                     <p>      
       <form id="addcart" name="addcart" method="post" action="./cart.php">
       <input type="hidden" name="name" id="name" value="<?php echo $items[0]; ?> "/>
       <input type="hidden" name="price" id="price" value="<?php echo $items[1]; ?> "/>
       <input type="hidden" name="id" id="id" value="<?php echo $items[3]; ?> "/>
       <input type="hidden" name="URL" id="URL" value="<?php echo $items[2]; ?> "/>
       <input type="submit" name="button" id="button" value="Add to Cart" />
       </form>

                     </p>
		     <p><a class="btn" href="#">Add to Favorites &raquo;</a></p>
                   </div><!--/row-->
               </div><!--/span-->
          </div><!--/row-->
<hr>
              <div class="row-fluid">
                <header id="overview">

<!-- Daily Deals -->
                    <h1>Similar Items</h1>
                </div>
<div class="row-fluid">
                      <div class="span3">
                          <a href="#" title="image 01"><img src="http://lh4.googleusercontent.com/public/US-Swxt81atxrCmkdef2KMHV9vY8i0iOxh8Dojke04LxsMkwp_oj_962wctatxuTJqAuio_aGnHA91uUSn4zi6o32_R_sMq_-fm79BlsbkSslh910iMxAEnXiseZ_agGQfV77pGpM5Zaqutuve67X12_kaE9wZbMDkShNVdy57P_kxFEnb4sXCTy_Q=s220-c" width="150" height="176" alt="image 01" border="0" /></a>
                          <p>Klein Tools MM200 Auto Ranging Multimeter </p> <p>Price: $49.00 </p> 
                          <p><a class="btn" href="#">Add to Cart &raquo;</a></p>
                      </div><!--/span-->
                      <div class="span3">
                          <a href="#" title="image 01"><img src="http://lh6.googleusercontent.com/public/fW5hVuInNLs8mHj4Oau_anxrSnXnyL5vi0ZGhvsafGoF_aOxH_LLukMPxcvj8B9dZsQpmKDRAGriNTYVqWTxSNjwzDVWXELL3G_5YYGTBM4DiblP0rLmi14ywgV0Nu8cGljqAOvflTvW8IW3kT0uT_ZZG5Tomg4VZmy64QzvSkPGCOWcr6FQfKWvYg=s220-c" width="150" height="176" alt="image 01" border="0" /></a>
                          <p>Milwaukee 2216-20NST Digital Multimeter,600V,10A </p> <p>Price: $129.00 </p>
                          <p><a class="btn" href="#">Add to Cart &raquo;</a></p>
                      </div><!--/span-->
                      <div class="span3">
                          <a href="#" title="image 01"><img src="http://lh6.googleusercontent.com/public/f1Ahu-AtAp2KCQOQaiL600flLwUs9EpfJQSPgreYEm7fLueU92kRgJ_XJbcHLAfzSIKUNnMbEsDO0dIPBAQhQoYa1K-YBp30ib5pDe-Vvzw5T3acmedESaXerhzoTgZ3oaqy-PlIRdahu6iV_S_2FVzvfrC1XcQv=s220-c" width="150" height="176" alt="image 01" border="0" /></a>
                          <p>Fluke 321 Clamp-On Digital Multimeter, 400A, 600V, AC </p> <p>Price: $77.00 </p>
                          <p><a class="btn" href="#">Add to Cart &raquo;</a></p>
                      </div><!--/span-->
                      <div class="span3">
                          <a href="#" title="image 01"><img src="http://lh5.googleusercontent.com/public/E_X8LFtk0hVlgSUQMtlDqRtdBhKPaXgLZyj2zj3QSrFLXjhbzXzo8XrwLgKjmwucN70PkEPcEcmdFMV91mwHR4TYJb8jtM2H1K4zx066b6Ue-qz8dPkrhNVf7qm049A2GqJlarE9mSyq4a0ujsmOxgd38fhEiWXuyXN9MJsbAQ=s220-c" width="150" height="176" alt="image 01" border="0" /></a>
                          <p>FLUKE-114 Electrical TRMS Multimeter Meter Tester Test Equipment </p> <p>Price: $126.00 </p>
                          <p><a class="btn" href="#">Add to Cart &raquo;</a></p>
                      </div><!--/span-->
                  </div><!--/row-->



      <hr>

      <footer>
        <p>&copy; Company 2012</p>
      </footer>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="scripts/js/jquery.js"></script>
    <script src="scripts/js/bootstrap-transition.js"></script>
    <script src="scripts/js/bootstrap-alert.js"></script>
    <script src="scripts/js/bootstrap-dropdown.js"></script>
    <script src="scripts/js/bootstrap-tab.js"></script>
    <script src="scripts/js/bootstrap-button.js"></script>
    <script src="scripts/js/bootstrap-carousel.js"></script>
    <script>
       $(document).ready(function(){
        $('.carousel').carousel();
       });
    </script>







</body>

</html>
